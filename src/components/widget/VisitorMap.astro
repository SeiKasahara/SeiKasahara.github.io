---
import WidgetLayout from "./WidgetLayout.astro";
import { getLangFromUrl, useTranslations } from "@/i18n";

interface Props {
    class?: string;
    style?: string;
}

const className = Astro.props.class;
const style = Astro.props.style;

const currentLang = getLangFromUrl(Astro.url);
const t = useTranslations(currentLang);
---

<WidgetLayout id="visitor-map" name={t('widget.visitorMap')} class={className} style={style}>
    <div class="flex justify-center items-center min-h-[200px]" id="revolver-map-container">
        <!-- Revolver Maps 将在这里渲染 -->
    </div>
</WidgetLayout>

<script is:inline>
document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('revolver-map-container');
    if (container && !container.querySelector('script')) {
        const script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = '//rf.revolvermaps.com/0/0/6.js?i=5tgz58z43ew&m=7&c=e63100&cr1=ffffff&f=arial&l=0&bv=90&lx=-420&ly=420&hi=20&he=7&hc=a8ddff&rs=80';
        script.async = true;
        container.appendChild(script);
    }
});
</script>
