---
import WidgetLayout from "./WidgetLayout.astro";
import { getLangFromUrl, useTranslations } from "@/i18n";

interface Props {
    class?: string;
    style?: string;
}

const className = Astro.props.class;
const style = Astro.props.style;

const currentLang = getLangFromUrl(Astro.url);
const t = useTranslations(currentLang);
---

<WidgetLayout id="visitor-map" name={t('widget.visitorMap')} class={className} style={style}>
    <div class="flex justify-center items-center min-h-[200px]" id="clustrmaps-container">
        <!-- ClustrMaps Globe -->
    </div>
</WidgetLayout>

<script is:inline>
(function() {
    function initClustrMaps() {
        const container = document.getElementById('clustrmaps-container');
        if (container && !container.querySelector('script')) {
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.id = 'mmvst_globe';
            script.src = '//mapmyvisitors.com/globe.js?d=E0WRDyfEOG7Ed6rOh2eTBTDxt1h2pQHzTEQVVzZ7atc';
            script.async = true;
            container.appendChild(script);
        }
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initClustrMaps);
    } else {
        initClustrMaps();
    }

    document.addEventListener('swup:page:view', initClustrMaps);
})();
</script>
