---
import WidgetLayout from "./WidgetLayout.astro";
import { Icon } from "astro-icon/components";
import { getLangFromUrl, useTranslations } from "@/i18n";

interface Props {
    class?: string;
    style?: string;
}

const className = Astro.props.class;
const style = Astro.props.style;

const currentLang = getLangFromUrl(Astro.url);
const t = useTranslations(currentLang);

// 建站时间
const createTime = "2020/07/05 17:38:00";

// 传递给客户端的翻译
const unitDays = t('stats.days');
const unitHours = t('stats.hours');
const unitMinutes = t('stats.minutes');
const unitSeconds = t('stats.seconds');
---

<WidgetLayout id="site-runtime" name={t('widget.siteRuntime')} class={className} style={style}>
    <div class="flex flex-col gap-2 text-neutral-700 dark:text-neutral-300">
        <div class="flex items-center gap-2">
            <Icon name="fa6-solid:clock" class="text-[var(--primary)]" />
            <span>{t('stats.siteRunning')}</span>
        </div>
        <div id="site-runtime-display" class="text-center font-mono text-sm bg-black/5 dark:bg-white/5 rounded-lg py-2 px-3">
            <span id="runtime-day">0</span> <span class="runtime-unit-day">{unitDays}</span>
            <span id="runtime-hour">0</span> <span class="runtime-unit-hour">{unitHours}</span>
            <span id="runtime-min">0</span> <span class="runtime-unit-min">{unitMinutes}</span>
            <span id="runtime-sec">0</span> <span class="runtime-unit-sec">{unitSeconds}</span>
        </div>
    </div>
</WidgetLayout>

<script is:inline define:vars={{ createTime }}>
function updateRuntime() {
    const now = new Date();
    const start = new Date(createTime);
    const diff = now - start;

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

    const dayEl = document.getElementById('runtime-day');
    const hourEl = document.getElementById('runtime-hour');
    const minEl = document.getElementById('runtime-min');
    const secEl = document.getElementById('runtime-sec');

    if (dayEl) dayEl.textContent = days;
    if (hourEl) hourEl.textContent = hours;
    if (minEl) minEl.textContent = minutes;
    if (secEl) secEl.textContent = seconds;
}

// 初始更新
updateRuntime();
// 每秒更新
setInterval(updateRuntime, 1000);
</script>
